<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: flickr | Matt Kelsey]]></title>
  <link href="http://kelsmj.github.com/blog/categories/flickr/atom.xml" rel="self"/>
  <link href="http://kelsmj.github.com/"/>
  <updated>2013-05-15T11:49:49-04:00</updated>
  <id>http://kelsmj.github.com/</id>
  <author>
    <name><![CDATA[Matt Kelsey]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Download Photos From Flickr Via API]]></title>
    <link href="http://kelsmj.github.com/2011/07/09/Flickr-Api-Grab-Photos-Example/"/>
    <updated>2011-07-09T14:30:00-04:00</updated>
    <id>http://kelsmj.github.com/2011/07/09/Flickr-Api-Grab-Photos-Example</id>
    <content type="html"><![CDATA[<p>In my <a href="http://mkelsey.com/2011/07/03/Flickr-oAuth-Python-Example.html">previous post</a>, I gave an example of how to authenticate a user against the Flickr API using their new OAuth authentication scheme.</p>

<p>I am going to expand on that post a bit, and show you how to download all the images for a given photo using the <a href="http://www.flickr.com/services/api/explore/flickr.photos.getSizes">flickr.photos.getSizes</a> API call.  </p>

<p>If you followed my previous post, you should have a “token” file in your directory that contains the “oauth_token” and “oauth_token_secret” in it.  You should also have an “apikeys” file that contains your application “api_key” and “secret”.  We will need some code to read these files to get the keys and secrets.</p>

<p>Here is what I came up with:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">APIKeys</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class='line'>    <span class="err">“</span><span class="s">&quot;”Base class to read the APIKeys from file”””&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s">&#39;apikeys&#39;</span><span class="p">):</span>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>        <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'>    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EACCESS</span><span class="p">:</span>
</span><span class='line'>            <span class="k">print</span> <span class="s">&quot;file does not exists&quot;</span>
</span><span class='line'>        <span class="c"># Not a permission error.</span>
</span><span class='line'>        <span class="k">raise</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="k">with</span> <span class="n">fp</span><span class="p">:</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">apisecret</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span class='line'>        <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">class</span> <span class="nc">TokenKeys</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class='line'>    <span class="err">“</span><span class="s">&quot;”Base class to read the Access Tokens”””&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s">&#39;token&#39;</span><span class="p">):</span>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>        <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'>    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EACCESS</span><span class="p">:</span>
</span><span class='line'>            <span class="k">print</span> <span class="s">&quot;file does not exists&quot;</span>
</span><span class='line'>        <span class="c"># Not a permission error.</span>
</span><span class='line'>        <span class="k">raise</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="k">with</span> <span class="n">fp</span><span class="p">:</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">secret</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span class='line'>        <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The next task at hand was coming up with a base class that can encapsulate all the work needed in order to make subsequent Flickr API calls once you have your api key and token.  I named this class “FlickrApiMethod” and it sets up all the data needed to make Flickr API requests.  It has a “makeCall” method that will make the REST call, load the returned JSON content and return True if the call was successful, or False if it was not.  I plan on expanding on this a bit to support all the different response formats that Flickr supports, but for now it just supports JSON.  This class also has an no implementation “getParameters” method that allows subclasses to fill out additional parameters that are needed for a specialized API call.</p>

<p>Here is the code:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">FlickrApiMethod</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class='line'>    <span class="err">“</span><span class="s">&quot;”Base class for Flickr API calls”””&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nojsoncallback</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;json&#39;</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>    <span class="n">apifile</span> <span class="o">=</span> <span class="n">APIKeys</span><span class="p">()</span>
</span><span class='line'>    <span class="n">tokenfile</span> <span class="o">=</span> <span class="n">TokenKeys</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">consumer</span> <span class="o">=</span> <span class="n">oauth</span><span class="o">.</span><span class="n">Consumer</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">apifile</span><span class="o">.</span><span class="n">apikey</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="n">apifile</span><span class="o">.</span><span class="n">apisecret</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">oauth</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="n">tokenfile</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">tokenfile</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="n">nojsoncallback</span><span class="p">:</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">nojsoncallback</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">nojsoncallback</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">if</span> <span class="ow">not</span> <span class="n">parameters</span><span class="p">:</span>
</span><span class='line'>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://api.flickr.com/services/rest&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;format&#39;</span><span class="p">:</span><span class="n">format</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;nojsoncallback&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">nojsoncallback</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;oauth_timestamp&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())),</span>
</span><span class='line'>        <span class="s">&#39;oauth_nonce&#39;</span><span class="p">:</span> <span class="n">oauth</span><span class="o">.</span><span class="n">generate_nonce</span><span class="p">(),</span>
</span><span class='line'>        <span class="s">&#39;signature_method&#39;</span><span class="p">:</span> <span class="s">&quot;HMAC-SHA1&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;oauth_token&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;oauth_consumer_key&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">defaults</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">makeCall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getParameters</span><span class="p">())</span>
</span><span class='line'>    <span class="n">req</span> <span class="o">=</span> <span class="n">oauth</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
</span><span class='line'>    <span class="n">req</span><span class="p">[</span><span class="s">&#39;oauth_signature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oauth</span><span class="o">.</span><span class="n">SignatureMethod_HMAC_SHA1</span><span class="p">()</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">consumer</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
</span><span class='line'>    <span class="n">h</span> <span class="o">=</span> <span class="n">httplib2</span><span class="o">.</span><span class="n">Http</span><span class="p">(</span><span class="s">&quot;.cache&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">resp</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">to_url</span><span class="p">(),</span> <span class="s">&quot;GET&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&quot;stat&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;ok&quot;</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">True</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">False</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">getParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</code></pre>

<p>Next, I will write a class, that given a unique “photo_id” it will call the <a href="http://www.flickr.com/services/api/explore/flickr.photos.getSizes">flickr.photos.getSizes</a> method and write out the files for all the sizes available.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">FlickrPhotosGetSizes</span><span class="p">(</span><span class="n">FlickrApiMethod</span><span class="p">):</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span><span class="err">’</span><span class="n">flickr</span><span class="o">.</span><span class="n">photos</span><span class="o">.</span><span class="n">getSizes</span><span class="err">’</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nojsoncallback</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;json&#39;</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">photo_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>    <span class="n">FlickrApiMethod</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nojsoncallback</span><span class="p">,</span><span class="n">format</span><span class="p">,</span><span class="n">parameters</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">photo_id</span> <span class="o">=</span> <span class="n">photo_id</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">getParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="n">p</span> <span class="o">=</span><span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;method&#39;</span><span class="p">:</span><span class="s">&#39;flickr.photos.getSizes&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;photo_id&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">photo_id</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">p</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">writePhotos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&quot;sizes&quot;</span><span class="p">][</span><span class="s">&quot;size&quot;</span><span class="p">]:</span>
</span><span class='line'>        <span class="n">opener</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">build_opener</span><span class="p">()</span>
</span><span class='line'>        <span class="n">page</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s">&quot;source&quot;</span><span class="p">])</span>
</span><span class='line'>        <span class="n">my_picture</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'>        <span class="n">filename</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s">&quot;label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="o">+</span><span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">photo_id</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s">&quot;source&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
</span><span class='line'>        <span class="k">print</span> <span class="n">filename</span>
</span><span class='line'>        <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&quot;wb&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">my_picture</span><span class="p">)</span>
</span><span class='line'>        <span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</code></pre>

<p>Finally, a little bit of code to use these classes:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">print</span> <span class="err">“</span><span class="n">Please</span> <span class="n">enter</span> <span class="n">a</span> <span class="n">photo</span> <span class="nb">id</span><span class="p">:</span><span class="err">”</span><span class="p">,</span>
</span><span class='line'><span class="n">photoId</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">()</span>
</span><span class='line'><span class="k">print</span> <span class="err">“</span><span class="n">Fetching</span> <span class="n">Photo</span><span class="err">”</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">photoSizes</span> <span class="o">=</span> <span class="n">FlickrPhotosGetSizes</span><span class="p">(</span><span class="n">photo_id</span> <span class="o">=</span> <span class="n">photoId</span><span class="p">)</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="n">photoSizes</span><span class="o">.</span><span class="n">makeCall</span><span class="p">()):</span>
</span><span class='line'>	<span class="k">print</span> <span class="err">“</span><span class="n">API</span> <span class="n">Call</span> <span class="n">Success</span><span class="err">!</span> <span class="n">Writing</span> <span class="n">Photos</span> <span class="n">to</span> <span class="n">Disk</span><span class="err">”</span>
</span><span class='line'>	<span class="n">photoSizes</span><span class="o">.</span><span class="n">writePhotos</span><span class="p">()</span>
</span><span class='line'><span class="k">else</span><span class="p">:</span>
</span><span class='line'>	<span class="k">print</span> <span class="err">“</span><span class="n">API</span> <span class="n">Call</span> <span class="n">Failed</span><span class="err">”</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>If all went well, you should now have files in your directory for all the different sizes of the photo you specified.</p>

<p>Feel free to email me with any questions or comments.  The git repo for this is located <a href="https://github.com/kelsmj/FlickrOAuth">here</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OAuth User Authentication for Flickr in Python]]></title>
    <link href="http://kelsmj.github.com/2011/07/03/Flickr-oAuth-Python-Example/"/>
    <updated>2011-07-03T14:30:00-04:00</updated>
    <id>http://kelsmj.github.com/2011/07/03/Flickr-oAuth-Python-Example</id>
    <content type="html"><![CDATA[<p>I always wanted to write an application that will use the Flickr API to pull all my photos from Flickr and store them locally, so I can further back them up via <a href="http://www.crasphlan.com">Crashplan</a>.</p>

<p>I decided to write this app in python, a language which I have no professional experience in, and have only recently dabbled with.  I figured it would be a good learning experience.  We will see!</p>

<p>The first thing that needs to be accomplished, in order to make calls to the Flickr API, is authenticate a user.  Flickr just recently added support for using OAuth to authenticate a user <a href="http://www.flickr.com/services/api/auth.oauth.html">Using OAuth with Flickr</a> and they will be removing their old authentication API in the future.  The focus of this post will outline the steps I took in order to successfully use OAuth to authenticate against my application.</p>

<p>The code below has two prerequisites in order to work correctly:</p>

<ol>
  <li>A text file called “apikeys” in the root directory containing the api_key (consumer_key) and secret for your application.  You get the key and secret by creating a new Flickr Application associated with your account.  Go to “The App Garden”:http://www.flickr.com/services/apps/create/apply/ to apply for one.  Each entry in this file needs to be on its own line with the api_key coming first.</li>
  <li>Downloading and installing “python-oauth2”:https://github.com/simplegeo/python-oauth2</li>
</ol>

<p>To setup python-oauth2:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>~/$ git clone https://github.com/simplegeo/python-oauth2.git
</span><span class='line'>~/$ ./setup.py install</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The first thing to understand about using OAuth with Flickr, is every request must be signed using the HMAC-SHA1 signature encryption.  You do this by building a Request object via the python-oauth2 Request method, passing in the url you want to make the request to and the parameters you want to send.  You then call the SignatureMethod_HMAC_SHA1().sign method and add the resulting signature to the Request.</p>

<p>The begin the authentication procedure, you first need to create a request that will get a request token.  The request will be made to http://www.flickr.com/services/oauth/request_token with the following paramaters:
* oauth_timestamp
* oauth_signature_method
* oauth_version
* oauth_callback
* oauth_nonce
* oauth_consumer_key
* oauth_signature</p>

<p>The code to perform this operation:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">url</span> <span class="o">=</span> <span class="err">“</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">flickr</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">services</span><span class="o">/</span><span class="n">oauth</span><span class="o">/</span><span class="n">request_token</span><span class="err">”</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;set-the-base-oauth-parameters-along-with-any-other-parameters-required&quot;</span><span class="o">&gt;</span><span class="n">Set</span> <span class="n">the</span> <span class="n">base</span> <span class="n">oauth_</span><span class="o">*</span> <span class="n">parameters</span> <span class="n">along</span> <span class="k">with</span> <span class="nb">any</span> <span class="n">other</span> <span class="n">parameters</span> <span class="n">required</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c"># for the API call.</span>
</span><span class='line'><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>	<span class="err">‘</span><span class="n">oauth_timestamp</span><span class="err">’</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())),</span>
</span><span class='line'>	<span class="err">‘</span><span class="n">oauth_signature_method</span><span class="err">’</span><span class="p">:</span><span class="err">”</span><span class="n">HMAC</span><span class="o">-</span><span class="n">SHA1</span><span class="err">”</span><span class="p">,</span>
</span><span class='line'>	<span class="err">‘</span><span class="n">oauth_version</span><span class="err">’</span><span class="p">:</span> <span class="err">“</span><span class="mf">1.0</span><span class="err">”</span><span class="p">,</span>
</span><span class='line'>	<span class="err">‘</span><span class="n">oauth_callback</span><span class="err">’</span><span class="p">:</span> <span class="err">“</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">mkelsey</span><span class="o">.</span><span class="n">com</span><span class="err">”</span><span class="p">,</span>
</span><span class='line'>	<span class="err">‘</span><span class="n">oauth_nonce</span><span class="err">’</span><span class="p">:</span> <span class="n">oauth</span><span class="o">.</span><span class="n">generate_nonce</span><span class="p">(),</span>
</span><span class='line'>	<span class="err">‘</span><span class="n">oauth_consumer_key</span><span class="err">’</span><span class="p">:</span> <span class="n">keys</span><span class="o">.</span><span class="n">apikey</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;setup-the-consumer-with-the-apikeys-given-by-the-provider&quot;</span><span class="o">&gt;</span><span class="n">Setup</span> <span class="n">the</span> <span class="n">Consumer</span> <span class="k">with</span> <span class="n">the</span> <span class="n">api_keys</span> <span class="n">given</span> <span class="n">by</span> <span class="n">the</span> <span class="n">provider</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">consumer</span> <span class="o">=</span> <span class="n">oauth</span><span class="o">.</span><span class="n">Consumer</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">keys</span><span class="o">.</span><span class="n">apikey</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="n">keys</span><span class="o">.</span><span class="n">apisecret</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;create-our-request-change-method-etc-accordingly&quot;</span><span class="o">&gt;</span><span class="n">Create</span> <span class="n">our</span> <span class="n">request</span><span class="o">.</span> <span class="n">Change</span> <span class="n">method</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span> <span class="n">accordingly</span><span class="o">.&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">req</span> <span class="o">=</span> <span class="n">oauth</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="err">”</span><span class="n">GET</span><span class="err">”</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;create-the-signature&quot;</span><span class="o">&gt;</span><span class="n">Create</span> <span class="n">the</span> <span class="n">signature</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">signature</span> <span class="o">=</span> <span class="n">oauth</span><span class="o">.</span><span class="n">SignatureMethod_HMAC_SHA1</span><span class="p">()</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="n">consumer</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;add-the-signature-to-the-request&quot;</span><span class="o">&gt;</span><span class="n">Add</span> <span class="n">the</span> <span class="n">Signature</span> <span class="n">to</span> <span class="n">the</span> <span class="n">request</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">req</span><span class="p">[</span><span class="err">‘</span><span class="n">oauth_signature</span><span class="err">’</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;make-the-request-to-get-the-oauthtoken-and-the-oauthtokensecret&quot;</span><span class="o">&gt;</span><span class="n">Make</span> <span class="n">the</span> <span class="n">request</span> <span class="n">to</span> <span class="n">get</span> <span class="n">the</span> <span class="n">oauth_token</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">oauth_token_secret</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c"># I had to directly use the httplib2 here, instead of the oauth library.</span>
</span><span class='line'><span class="n">h</span> <span class="o">=</span> <span class="n">httplib2</span><span class="o">.</span><span class="n">Http</span><span class="p">(</span><span class="err">“</span><span class="o">.</span><span class="n">cache</span><span class="err">”</span><span class="p">)</span>
</span><span class='line'><span class="n">resp</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">to_url</span><span class="p">(),</span> <span class="err">“</span><span class="n">GET</span><span class="err">”</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>If all is successful, Flickr include a <em>oauth_token</em> and a <em>oauth_token_secret</em> in the Response.  You can now store those tokens off and prompt a user to go authorize your application.  They will need to go to http://www.flickr.com/services/oauth/authorize with the <em>oauth_token</em> appended as a querystring parameter along with the perms parameter indicating if your application will need read,write and delete privileges.  Once the user authorizes your application, Flickr will redirect to the <em>oauth_callback</em> url specified above with a <em>oauth_verifier</em> querystring parameter that you can then use in the third and final step of oAuth authentication.</p>

<p>The code to perform this operation:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">authorize_url</span> <span class="o">=</span> <span class="err">“</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">flickr</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">services</span><span class="o">/</span><span class="n">oauth</span><span class="o">/</span><span class="n">authorize</span><span class="err">”</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;parse-the-content&quot;</span><span class="o">&gt;</span><span class="n">parse</span> <span class="n">the</span> <span class="n">content</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">request_token</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">urlparse</span><span class="o">.</span><span class="n">parse_qsl</span><span class="p">(</span><span class="n">content</span><span class="p">))</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">print</span> <span class="err">“</span><span class="n">Request</span> <span class="n">Token</span><span class="p">:</span><span class="err">”</span>
</span><span class='line'><span class="k">print</span> <span class="err">“</span>    <span class="o">-</span> <span class="n">oauth_token</span>        <span class="o">=</span> <span class="o">%</span><span class="n">s</span><span class="err">”</span> <span class="o">%</span> <span class="n">request_token</span><span class="p">[</span><span class="err">‘</span><span class="n">oauth_token</span><span class="err">’</span><span class="p">]</span>
</span><span class='line'><span class="k">print</span> <span class="err">“</span>    <span class="o">-</span> <span class="n">oauth_token_secret</span> <span class="o">=</span> <span class="o">%</span><span class="n">s</span><span class="err">”</span> <span class="o">%</span> <span class="n">request_token</span><span class="p">[</span><span class="err">‘</span><span class="n">oauth_token_secret</span><span class="err">’</span><span class="p">]</span>
</span><span class='line'><span class="k">print</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;create-the-token-object-with-returned-oauthtoken-and-oauthtokensecret&quot;</span><span class="o">&gt;</span><span class="n">Create</span> <span class="n">the</span> <span class="n">token</span> <span class="nb">object</span> <span class="k">with</span> <span class="n">returned</span> <span class="n">oauth_token</span> <span class="ow">and</span> <span class="n">oauth_token_secret</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">token</span> <span class="o">=</span> <span class="n">oauth</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="n">request_token</span><span class="p">[</span><span class="err">‘</span><span class="n">oauth_token</span><span class="err">’</span><span class="p">],</span>
</span><span class='line'>	<span class="n">request_token</span><span class="p">[</span><span class="err">‘</span><span class="n">oauth_token_secret</span><span class="err">’</span><span class="p">])</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;you-need-to-authorize-this-app-via-your-browser&quot;</span><span class="o">&gt;</span><span class="n">You</span> <span class="n">need</span> <span class="n">to</span> <span class="n">authorize</span> <span class="n">this</span> <span class="n">app</span> <span class="n">via</span> <span class="n">your</span> <span class="n">browser</span><span class="o">.&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">print</span> <span class="err">“</span><span class="n">Go</span> <span class="n">to</span> <span class="n">the</span> <span class="n">following</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">browser</span><span class="p">:</span><span class="err">”</span>
</span><span class='line'><span class="k">print</span> <span class="err">“</span><span class="o">%</span><span class="n">s</span><span class="err">?</span><span class="n">oauth_token</span><span class="o">=%</span><span class="n">s</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">perms</span><span class="o">=</span><span class="n">read</span><span class="err">”</span> <span class="o">%</span>
</span><span class='line'>	<span class="p">(</span><span class="n">authorize_url</span><span class="p">,</span> <span class="n">request_token</span><span class="p">[</span><span class="err">‘</span><span class="n">oauth_token</span><span class="err">’</span><span class="p">])</span>
</span><span class='line'><span class="k">print</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;once-you-get-the-verified-pin-input-it&quot;</span><span class="o">&gt;</span><span class="n">Once</span> <span class="n">you</span> <span class="n">get</span> <span class="n">the</span> <span class="n">verified</span> <span class="n">pin</span><span class="p">,</span> <span class="nb">input</span> <span class="n">it</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">accepted</span> <span class="o">=</span> <span class="err">‘</span><span class="n">n</span><span class="err">’</span>
</span><span class='line'><span class="k">while</span> <span class="n">accepted</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="err">‘</span><span class="n">n</span><span class="err">’</span><span class="p">:</span>
</span><span class='line'>    <span class="n">accepted</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="err">‘</span><span class="n">Have</span> <span class="n">you</span> <span class="n">authorized</span> <span class="n">me</span><span class="err">?</span> <span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="err">‘</span><span class="p">)</span>
</span><span class='line'><span class="n">oauth_verifier</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="err">‘</span><span class="n">What</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">PIN</span><span class="err">?</span> <span class="err">‘</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;set-the-oauthverifier-token&quot;</span><span class="o">&gt;</span><span class="nb">set</span> <span class="n">the</span> <span class="n">oauth_verifier</span> <span class="n">token</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">token</span><span class="o">.</span><span class="n">set_verifier</span><span class="p">(</span><span class="n">oauth_verifier</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The third and final step in authenticating is exchanging the Request Token for an Access Token.  The Access Token is something you will store off for that user and you will be able to make Flickr API calls using the Access Token.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># url to get access token</span>
</span><span class='line'><span class="n">access_token_url</span> <span class="o">=</span> <span class="err">“</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">flickr</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">services</span><span class="o">/</span><span class="n">oauth</span><span class="o">/</span><span class="n">access_token</span><span class="err">”</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;now-you-need-to-exchange-your-request-token-for-an-access-token&quot;</span><span class="o">&gt;</span><span class="n">Now</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">exchange</span> <span class="n">your</span> <span class="n">Request</span> <span class="n">Token</span> <span class="k">for</span> <span class="n">an</span> <span class="n">Access</span> <span class="n">Token</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c"># Set the base oauth_* parameters along with any other parameters required</span>
</span><span class='line'><span class="c"># for the API call.</span>
</span><span class='line'><span class="n">access_token_parms</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>	<span class="err">‘</span><span class="n">oauth_consumer_key</span><span class="err">’</span><span class="p">:</span> <span class="n">keys</span><span class="o">.</span><span class="n">apikey</span><span class="p">,</span>
</span><span class='line'>	<span class="err">‘</span><span class="n">oauth_nonce</span><span class="err">’</span><span class="p">:</span> <span class="n">oauth</span><span class="o">.</span><span class="n">generate_nonce</span><span class="p">(),</span>
</span><span class='line'>	<span class="err">‘</span><span class="n">oauth_signature_method</span><span class="err">’</span><span class="p">:</span><span class="err">”</span><span class="n">HMAC</span><span class="o">-</span><span class="n">SHA1</span><span class="err">”</span><span class="p">,</span>
</span><span class='line'>	<span class="err">‘</span><span class="n">oauth_timestamp</span><span class="err">’</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())),</span>
</span><span class='line'>	<span class="err">‘</span><span class="n">oauth_token</span><span class="err">’</span><span class="p">:</span><span class="n">request_token</span><span class="p">[</span><span class="err">‘</span><span class="n">oauth_token</span><span class="err">’</span><span class="p">],</span>
</span><span class='line'>	<span class="err">‘</span><span class="n">oauth_verifier</span><span class="err">’</span> <span class="p">:</span> <span class="n">oauth_verifier</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;setup-request&quot;</span><span class="o">&gt;</span><span class="n">setup</span> <span class="n">request</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">req</span> <span class="o">=</span> <span class="n">oauth</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="err">”</span><span class="n">GET</span><span class="err">”</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">access_token_url</span><span class="p">,</span>
</span><span class='line'>	<span class="n">parameters</span><span class="o">=</span><span class="n">access_token_parms</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;create-the-signature-1&quot;</span><span class="o">&gt;</span><span class="n">create</span> <span class="n">the</span> <span class="n">signature</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">signature</span> <span class="o">=</span> <span class="n">oauth</span><span class="o">.</span><span class="n">SignatureMethod_HMAC_SHA1</span><span class="p">()</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="n">consumer</span><span class="p">,</span><span class="n">token</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;assign-the-signature-to-the-request&quot;</span><span class="o">&gt;</span><span class="n">assign</span> <span class="n">the</span> <span class="n">signature</span> <span class="n">to</span> <span class="n">the</span> <span class="n">request</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">req</span><span class="p">[</span><span class="err">‘</span><span class="n">oauth_signature</span><span class="err">’</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;make-the-request&quot;</span><span class="o">&gt;</span><span class="n">make</span> <span class="n">the</span> <span class="n">request</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">h</span> <span class="o">=</span> <span class="n">httplib2</span><span class="o">.</span><span class="n">Http</span><span class="p">(</span><span class="err">“</span><span class="o">.</span><span class="n">cache</span><span class="err">”</span><span class="p">)</span>
</span><span class='line'><span class="n">resp</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">to_url</span><span class="p">(),</span> <span class="err">“</span><span class="n">GET</span><span class="err">”</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;parse-the-response&quot;</span><span class="o">&gt;</span><span class="n">parse</span> <span class="n">the</span> <span class="n">response</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">access_token_resp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">urlparse</span><span class="o">.</span><span class="n">parse_qsl</span><span class="p">(</span><span class="n">content</span><span class="p">))</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">&quot;write-out-a-file-with-the-oauthtoken-and-oauthtokensecret&quot;</span><span class="o">&gt;</span><span class="n">write</span> <span class="n">out</span> <span class="n">a</span> <span class="nb">file</span> <span class="k">with</span> <span class="n">the</span> <span class="n">oauth_token</span> <span class="ow">and</span> <span class="n">oauth_token_secret</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="err">‘</span><span class="n">token</span><span class="err">’</span><span class="p">,</span> <span class="err">‘</span><span class="n">w</span><span class="err">’</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>	<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">access_token_resp</span><span class="p">[</span><span class="err">‘</span><span class="n">oauth_token</span><span class="err">’</span><span class="p">]</span> <span class="o">+</span> <span class="err">‘</span>\<span class="n">n</span><span class="err">’</span><span class="p">)</span>
</span><span class='line'>	<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">access_token_resp</span><span class="p">[</span><span class="err">‘</span><span class="n">oauth_token_secret</span><span class="err">’</span><span class="p">])</span>
</span><span class='line'><span class="n">f</span><span class="o">.</span><span class="n">closed</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>If all the requests succeeded you should have a token file in your directory with the <em>oauth_token</em> and the <em>oauth_token_secret</em>.  You can use these tokens to make subsequent requests to the Flickr API.  In my next post, I will illustrate how to do this.</p>

<p>Feel free to email me with any questions or comments.  The git repo for this is located <a href="https://github.com/kelsmj/FlickrOAuth">here</a></p>
]]></content>
  </entry>
  
</feed>
